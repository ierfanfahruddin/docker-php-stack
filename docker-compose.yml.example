# docker-compose.yml.example
# Salin file ini ke docker-compose.yml dan sesuaikan konfigurasinya
version: '3.8'

services:

  # --- WEB SERVER ---
  nginx:
    image: nginx:stable-alpine
    container_name: web-server
    ports:
      - "8080:80" # Akses di http://localhost:8080/proyek_a atau /proyek_b
    volumes:
      # Mount folder www/ ke root dokumen Nginx
      - ./www:/var/www/html
      # Mount konfigurasi Nginx kustom
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - php-83-fpm
      - php-74-fpm

  # --- PHP FPM 8.3 ---
  php-83-fpm:
    build:
      context: ./php-83-fpm # Gunakan Dockerfile yang sudah dibuat
    container_name: php-83-fpm
    volumes:
      - ./www:/var/www/html # Sinkronkan kode www
    expose:
      - "9000"

  # --- PHP FPM 7.4 ---
  php-74-fpm:
    build:
      context: ./php-74-fpm # Gunakan Dockerfile yang sudah dibuat
    container_name: php-74-fpm
    volumes:
      - ./www:/var/www/html
    expose:
      - "9000"

  # --- DATABASE (MySQL 8.0) ---
  db-mysql:
    image: mysql/mysql-server:8.0
    container_name: db-mysql-80
    environment:
      MYSQL_ROOT_PASSWORD: root_pass
      MYSQL_DATABASE: db_mysql
      MYSQL_USER: dev_user
      MYSQL_PASSWORD: dev_pass
    volumes:
      - mysql_data:/var/lib/mysql # Volume data
      # - ./mysql-8-data:/docker-entrypoint-initdb.d # Contoh: untuk skrip inisialisasi

  # --- DATABASE (PostgreSQL 13) ---
  db-postgre:
    image: postgres:13-alpine
    container_name: db-postgre-13
    environment:
      POSTGRES_DB: db_postgre
      POSTGRES_USER: dev_user
      POSTGRES_PASSWORD: dev_pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
      # - ./postgresql-data:/docker-entrypoint-initdb.d # Contoh: untuk skrip inisialisasi

volumes:
  mysql_data:
  postgres_data: